# ========= 基础 =========
http_port 3128
cache_effective_user proxy
cache_effective_group proxy

# ========= 日志 =========
access_log  /var/log/squid/access.log
cache_log   /var/log/squid/cache.log

# ========= 缓存目录（挂卷后可持久化）=========
cache_dir ufs /var/spool/squid 5000 16 256
cache_mem 256 MB
maximum_object_size 512 MB

# ========= 刷新策略 =========
refresh_pattern \.(jpg|png|gif|ico|css|js|woff|woff2|mp4|zip)$ 1440 50% 129600 override-expire ignore-no-cache ignore-no-store
refresh_pattern -i /$  0 20% 4320
refresh_pattern .      0 20% 4320

# ========= ACL & 访问控制 =========
acl SSL_ports port 443
acl Safe_ports port 80 21 443 70 210 1025-65535
acl CONNECT method CONNECT
acl localnet src 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
acl localnet src fc00::/7 fe80::/10

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access deny all

# ========= 隐藏版本/代理头 =========
forwarded_for delete
via off
request_header_access Via deny all
request_header_access X-Forwarded-For deny all

# ========= 其他 =========
visible_hostname squid.docker
dns_nameservers 8.8.8.8 8.8.4.4
logfile_rotate 10